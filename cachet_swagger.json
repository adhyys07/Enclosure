{"openapi":"3.0.0","info":{"title":"Cachet","version":"0.4.0","description":"A high-performance cache and proxy for Slack profile pictures and emojis with comprehensive analytics.","contact":{"name":"Kieran Klukas","email":"me@dunkirk.sh"},"license":{"name":"AGPL 3.0","url":"https://github.com/taciturnaxolotl/cachet/blob/main/LICENSE.md"}},"paths":{"/health":{"get":{"summary":"Health check","description":"Check if the service is healthy and operational. Add ?detailed=true for comprehensive health information including Slack API status, queue depth, and memory usage.","tags":["Health"],"responses":{"200":{"description":"Service is healthy","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"string","example":"healthy","enum":["healthy","degraded","unhealthy"]},"cache":{"type":"boolean","example":true},"uptime":{"type":"number","example":123456},"checks":{"type":"object","description":"Detailed checks (only with ?detailed=true)","properties":{"database":{"type":"object","properties":{"status":{"type":"boolean"},"latency":{"type":"number","description":"ms"}}},"slackApi":{"type":"object","properties":{"status":{"type":"boolean"},"error":{"type":"string"}}},"queueDepth":{"type":"number","description":"Number of users queued for update"},"memoryUsage":{"type":"object","properties":{"heapUsed":{"type":"number","description":"MB"},"heapTotal":{"type":"number","description":"MB"},"percentage":{"type":"number"},"details":{"type":"object","properties":{"heapUsedMiB":{"type":"number","description":"Precise heap used in MiB"},"heapTotalMiB":{"type":"number","description":"Precise heap total in MiB"},"heapPercent":{"type":"number","description":"Precise heap percentage"},"rssMiB":{"type":"number","description":"Resident Set Size in MiB"},"externalMiB":{"type":"number","description":"External memory in MiB"},"arrayBuffersMiB":{"type":"number","description":"Array buffers in MiB"}}}}}}}}}}}},"503":{"description":"Service is unhealthy"}},"parameters":[{"name":"detailed","in":"query","required":false,"description":"Return detailed health check information","schema":{"type":"boolean","example":false}}]}},"/users/{id}":{"get":{"summary":"Get user information","description":"Retrieve cached user profile information from Slack. User data is cached for 7 days before being refreshed.","tags":["Users"],"responses":{"200":{"description":"User information retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","example":"U062UG485EE"},"userId":{"type":"string","example":"U062UG485EE"},"displayName":{"type":"string","example":"Kieran Klukas"},"pronouns":{"type":"string","example":"he/him"},"imageUrl":{"type":"string","example":"https://avatars.slack-edge.com/..."}}}}}},"404":{"description":"User not found"}},"parameters":[{"name":"id","in":"path","required":true,"description":"Slack user ID","schema":{"type":"string","example":"U062UG485EE"}}]}},"/users/{id}/r":{"get":{"summary":"Redirect to user profile image","description":"Direct redirect to the user's cached profile image URL. User data is cached for 7 days.","tags":["Users"],"responses":{"302":{"description":"Redirect to user image"},"307":{"description":"Temporary redirect to default avatar"},"404":{"description":"User not found"}},"parameters":[{"name":"id","in":"path","required":true,"description":"Slack user ID","schema":{"type":"string","example":"U062UG485EE"}}]}},"/users/{id}/purge":{"post":{"summary":"Purge user cache","description":"Remove a specific user from the cache (requires authentication)","tags":["Users","Admin"],"responses":{"200":{"description":"User cache purged successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"User cache purged"},"userId":{"type":"string","example":"U062UG485EE"},"success":{"type":"boolean","example":true}}}}}},"401":{"description":"Unauthorized"}},"parameters":[{"name":"id","in":"path","required":true,"description":"Slack user ID to purge","schema":{"type":"string","example":"U062UG485EE"}}],"security":[{"bearerAuth":[]}]}},"/emojis":{"get":{"summary":"List all emojis","description":"Get a list of all cached custom emojis from the Slack workspace","tags":["Emojis"],"responses":{"200":{"description":"List of emojis retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"name":{"type":"string","example":"hackshark"},"imageUrl":{"type":"string","example":"https://emoji.slack-edge.com/..."},"alias":{"type":"string","nullable":true,"example":null}}}}}}}}}},"/emojis/{name}":{"get":{"summary":"Get emoji information","description":"Retrieve information about a specific custom emoji","tags":["Emojis"],"responses":{"200":{"description":"Emoji information retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","example":"hackshark"},"imageUrl":{"type":"string","example":"https://emoji.slack-edge.com/..."},"alias":{"type":"string","nullable":true,"example":null}}}}}},"404":{"description":"Emoji not found"}},"parameters":[{"name":"name","in":"path","required":true,"description":"Emoji name (without colons)","schema":{"type":"string","example":"hackshark"}}]}},"/emojis/{name}/r":{"get":{"summary":"Redirect to emoji image","description":"Direct redirect to the emoji's cached image URL","tags":["Emojis"],"responses":{"302":{"description":"Redirect to emoji image"},"404":{"description":"Emoji not found"}},"parameters":[{"name":"name","in":"path","required":true,"description":"Emoji name (without colons)","schema":{"type":"string","example":"hackshark"}}]}},"/reset":{"post":{"summary":"Reset entire cache","description":"Clear all cached data (requires authentication)","tags":["Admin"],"responses":{"200":{"description":"Cache reset successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"Cache has been reset"},"users":{"type":"number","example":42},"emojis":{"type":"number","example":1337}}}}}},"401":{"description":"Unauthorized"}},"security":[{"bearerAuth":[]}]}},"/api/stats/essential":{"get":{"summary":"Get essential analytics","description":"Fast-loading essential statistics for the dashboard","tags":["Analytics"],"responses":{"200":{"description":"Essential stats retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"totalRequests":{"type":"number","example":12345},"averageResponseTime":{"type":"number","nullable":true,"example":23.5},"uptime":{"type":"number","example":99.9}}}}}}},"parameters":[{"name":"days","in":"query","required":false,"description":"Number of days to analyze","schema":{"type":"number","example":7}}]}},"/api/stats/charts":{"get":{"summary":"Get chart data","description":"Time-series data for request and latency charts","tags":["Analytics"],"responses":{"200":{"description":"Chart data retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"requestsByDay":{"type":"array","items":{"type":"object","properties":{"date":{"type":"string","example":"2024-01-01 12:00:00"},"count":{"type":"number","example":42},"averageResponseTime":{"type":"number","example":25.3}}}},"latencyOverTime":{"type":"array","items":{"type":"object","properties":{"time":{"type":"string","example":"2024-01-01 12:00:00"},"averageResponseTime":{"type":"number","example":25.3},"p95":{"type":"number","nullable":true,"example":null},"count":{"type":"number","example":42}}}}}}}}}},"parameters":[{"name":"days","in":"query","required":false,"description":"Number of days to analyze","schema":{"type":"number","example":7}}]}},"/api/stats/useragents":{"get":{"summary":"Get user agents statistics","description":"Cumulative list of user agents accessing the service with hit counts (top 50) and total unique count","tags":["Analytics"],"responses":{"200":{"description":"User agents data retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"userAgents":{"type":"array","items":{"type":"object","properties":{"userAgent":{"type":"string","example":"Mozilla/5.0..."},"hits":{"type":"number","example":123}}}},"totalCount":{"type":"number","example":150}}}}}}}}},"/stats/traffic":{"get":{"summary":"Get traffic time-series data","description":"Returns bucketed traffic data with adaptive granularity based on time range","tags":["Analytics"],"responses":{"200":{"description":"Traffic data retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"bucket":{"type":"number","example":1704067200,"description":"Unix timestamp of bucket start"},"hits":{"type":"number","example":42},"avgLatency":{"type":"number","nullable":true,"example":25.3,"description":"Average response time in ms"}}}}}}}},"parameters":[{"name":"days","in":"query","required":false,"description":"Number of days to look back (default: 7)","schema":{"type":"number","example":7}},{"name":"start","in":"query","required":false,"description":"Start timestamp in seconds (use with end)","schema":{"type":"number"}},{"name":"end","in":"query","required":false,"description":"End timestamp in seconds (use with start)","schema":{"type":"number"}}]}},"/stats":{"get":{"summary":"Get complete analytics (legacy)","description":"Legacy endpoint returning all analytics data in one response","tags":["Analytics","Legacy"],"responses":{"200":{"description":"Complete analytics data retrieved","content":{"application/json":{"schema":{"type":"object","properties":{"totalRequests":{"type":"number"},"averageResponseTime":{"type":"number"},"chartData":{"type":"array"},"userAgents":{"type":"array"}}}}}}},"parameters":[{"name":"days","in":"query","required":false,"description":"Number of days to analyze","schema":{"type":"number","example":7}}]}},"/stats/essential":{"get":{"summary":"Get essential stats","description":"Fast-loading essential statistics for the dashboard","tags":["Analytics"],"responses":{"200":{"description":"Essential stats retrieved","content":{"application/json":{"schema":{"type":"object","properties":{"totalRequests":{"type":"number"},"averageResponseTime":{"type":"number"},"uptime":{"type":"number"}}}}}}},"parameters":[{"name":"days","in":"query","required":false,"description":"Number of days to analyze","schema":{"type":"number","example":7}}]}},"/stats/useragents":{"get":{"summary":"Get user agents","description":"Cumulative user agent statistics","tags":["Analytics"],"responses":{"200":{"description":"User agents retrieved","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"userAgent":{"type":"string"},"hits":{"type":"number"}}}}}}}}}},"/stats/referers":{"get":{"summary":"Get referer sources","description":"Cumulative referer host statistics showing traffic sources","tags":["Analytics"],"responses":{"200":{"description":"Referers retrieved","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"refererHost":{"type":"string"},"hits":{"type":"number"}}}}}}}}}}},"components":{"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer"}}}}